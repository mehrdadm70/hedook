<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">داشبورد مدیریت</h1>
    <button mat-raised-button color="primary" (click)="refreshData()" [disabled]="loading()">
      <mat-icon>refresh</mat-icon>
      بروزرسانی
    </button>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>در حال بارگذاری اطلاعات...</p>
    </div>
  }

  <!-- Error State -->
  @else if (error()) {
    <mat-card class="error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon class="error-icon">error</mat-icon>
          <h3>خطا در بارگذاری اطلاعات</h3>
          <p>{{ error() }}</p>
          <button mat-raised-button color="primary" (click)="retryLoad()">
            تلاش مجدد
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  }

  <!-- Dashboard Content -->
  @else if (hasStats()) {
    <div class="dashboard-content">
      <!-- Statistics Cards -->
      <div class="stats-grid">
        <mat-card class="stat-card products-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>inventory_2</mat-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-number">{{ formatNumber(stats()!.totalProducts) }}</h3>
                <p class="stat-label">کل محصولات</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card orders-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>shopping_cart</mat-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-number">{{ formatNumber(stats()!.totalOrders) }}</h3>
                <p class="stat-label">کل سفارشات</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card users-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>people</mat-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-number">{{ formatNumber(stats()!.totalUsers) }}</h3>
                <p class="stat-label">کل کاربران</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card revenue-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>attach_money</mat-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-number">{{ formatCurrency(stats()!.totalRevenue) }}</h3>
                <p class="stat-label">کل درآمد</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Secondary Stats -->
      <div class="secondary-stats">
        <mat-card class="stat-card warning">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>pending</mat-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-number">{{ formatNumber(stats()!.pendingOrders) }}</h3>
                <p class="stat-label">سفارشات در انتظار</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card alert">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>warning</mat-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-number">{{ formatNumber(stats()!.lowStockProducts) }}</h3>
                <p class="stat-label">محصولات کم موجود</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card monthly">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>trending_up</mat-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-number">{{ formatCurrency(stats()!.monthlyRevenue) }}</h3>
                <p class="stat-label">درآمد ماهانه</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Charts and Tables Row -->
      <div class="charts-row">
        <!-- Top Selling Products -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>پرفروش‌ترین محصولات</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (stats()!.topSellingProducts.length > 0) {
              <div class="top-products-list">
                @for (product of stats()!.topSellingProducts; track product.productId) {
                  <div class="product-item">
                    <div class="product-info">
                      <h4 class="product-name">{{ product.productName }}</h4>
                      <p class="product-sales">{{ formatNumber(product.totalSold) }} فروش</p>
                    </div>
                    <div class="product-revenue">
                      <span class="revenue-amount">{{ formatCurrency(product.revenue) }}</span>
                    </div>
                  </div>
                }
              </div>
            } @else {
              <p class="no-data">اطلاعاتی موجود نیست</p>
            }
          </mat-card-content>
        </mat-card>

        <!-- Recent Orders -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>آخرین سفارشات</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (stats()!.recentOrders.length > 0) {
              <mat-table [dataSource]="stats()!.recentOrders" class="recent-orders-table">
                <!-- Order ID Column -->
                <ng-container matColumnDef="orderId">
                  <mat-header-cell *matHeaderCellDef>شماره سفارش</mat-header-cell>
                  <mat-cell *matCellDef="let order">{{ order.orderId }}</mat-cell>
                </ng-container>

                <!-- Customer Name Column -->
                <ng-container matColumnDef="customerName">
                  <mat-header-cell *matHeaderCellDef>نام مشتری</mat-header-cell>
                  <mat-cell *matCellDef="let order">{{ order.customerName }}</mat-cell>
                </ng-container>

                <!-- Total Amount Column -->
                <ng-container matColumnDef="totalAmount">
                  <mat-header-cell *matHeaderCellDef>مبلغ</mat-header-cell>
                  <mat-cell *matCellDef="let order">{{ formatCurrency(order.totalAmount) }}</mat-cell>
                </ng-container>

                <!-- Status Column -->
                <ng-container matColumnDef="status">
                  <mat-header-cell *matHeaderCellDef>وضعیت</mat-header-cell>
                  <mat-cell *matCellDef="let order">
                    <mat-chip [color]="getStatusColor(order.status)">
                      {{ getStatusLabel(order.status) }}
                    </mat-chip>
                  </mat-cell>
                </ng-container>

                <!-- Created At Column -->
                <ng-container matColumnDef="createdAt">
                  <mat-header-cell *matHeaderCellDef>تاریخ</mat-header-cell>
                  <mat-cell *matCellDef="let order">{{ order.createdAt | date:'short':'fa-IR' }}</mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="recentOrdersColumns"></mat-header-row>
                <mat-row *matRowDef="let row; columns: recentOrdersColumns;"></mat-row>
              </mat-table>
            } @else {
              <p class="no-data">سفارشی موجود نیست</p>
            }
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  }
</div>